# Development Log - 2026-01-31 (Session 2)

## Major Refactoring & Logic Tuning

### 1. System Architecture Overhaul
*   **Input Restructuring:**
    *   Deprecated `Daily_Rejection` (YES/NO) -> Split into `Daily_Upper_Wick` and `Daily_Lower_Wick`.
    *   Deprecated `H1_Breakout` (0-100) -> Split into `H1_Bear_Break` and `H1_Bull_Break` to handle Expanding candles.
    *   Added explicit `Trend` input (Bearish / Sideways / Bullish).
*   **GUI Update (v9.00):**
    *   Redesigned `GUIPanel` to support 5 Dropdowns.
    *   Implemented `GUIAdapter` logic to map UI Enums to Fuzzy Values (0-100).

### 2. Logic & Rules Evolution
*   **Phase 1: Hardcoded Matrix (Rejected)**
    *   Attempted to create a 108-rule matrix to cover all combinations.
    *   *Decision:* Rejected due to complexity and loss of "Fuzzy" flexibility. Reverted to Aggregation logic.
*   **Phase 2: Aggregation Logic (Adopted)**
    *   Implemented core rules for Follow Trend (Trend + Wick + H1).
    *   Implemented **Friction Rules**: Penalize score when opposing Wick exists (e.g., Uptrend vs Upper Wick).
    *   Implemented **Counter Rules**: Penalize score when opposing Wick + H1 Breakout exist.
    *   Implemented **Momentum Drag**: Penalize score when strong opposing H1 Breakout exists (even without Wick).
*   **Phase 3: Fine-Tuning (The "Sweet Spot")**
    *   **Sideways:** Max Score reduced to **+/- 70** (vs +/- 90 previously) to respect Trend superiority.
    *   **Counter-Trend:** Increased impact to **MODERATE (+/- 60)** to prevent system from ignoring strong reversal signals in Trend.
    *   **Friction:** Reduced impact to **STARTING (+/- 15)** to avoid killing good trend trades.
    *   **Rule C3 (Counter-Ignore):** **REMOVED**. Proved to be double-punishment, dragging scores to zero unnecessarily.

### 3. Verification & Testing
*   **Python Simulator (Digital Twin):**
    *   Updated `fuzzy_simulator.py` to match MQL5 v0.99 Beta logic exactly.
    *   Added **Interactive GUI** with "Log Case" feature for manual debugging.
    *   Ran `scan_all_cases.py` (108 cases) to verify score distribution.
*   **Key Validated Scenarios:**
    *   **Perfect Buy (Uptrend):** +89.8 (Target 95).
    *   **Expanding Buy (Uptrend):** +53.2 (Target ~55).
    *   **Resisted Buy (Uptrend + Wick C):** +33.3 (Weak Buy).
    *   **Expanding Sell (Downtrend):** -53.2.
    *   **Sideways Chaos:** 0.0 (Neutral).

### 4. Documentation
*   Updated `rules.csv` with the final set of Confirmed Rules (including Friction/Counter/Conflict).
*   Updated `fuzzy_logic_specs.csv` with new Inputs/Outputs.

## Current Status
*   **Version:** v0.99 Beta
*   **Stability:** High.
*   **Logic:** Trade-ready. Handles complex market conditions (Expanding, Pinbars) organically.